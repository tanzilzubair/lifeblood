import { setupScrollingAndScrollAnimations } from "./full_page_scrolling.js";
import { setupMenu } from "./setup_menu.js";
import { intializeBarba } from "./barba_setup.js";
import { destroyIntro, initializeIntro } from "./spline.js";

(() => {
    let oldPushState = history.pushState;
    history.pushState = function pushState() {
        let ret = oldPushState.apply(this, arguments);
        window.dispatchEvent(new Event('pushstate'));
        window.dispatchEvent(new Event('locationchange'));
        return ret;
    };

    let oldReplaceState = history.replaceState;
    history.replaceState = function replaceState() {
        let ret = oldReplaceState.apply(this, arguments);
        window.dispatchEvent(new Event('replacestate'));
        window.dispatchEvent(new Event('locationchange'));
        return ret;
    };

    window.addEventListener('popstate', () => {
        window.dispatchEvent(new Event('locationchange'));
    });
})();


var scrollI = window.location.href.includes("#I");
var scrollII = window.location.href.includes("#II");
var scrollIII = window.location.href.includes("#III");
var contact = window.location.href.includes("#contact");

var pageI = window.location.href.includes("/I");
var pageII = window.location.href.includes("/II");
var pageIII = window.location.href.includes("/III");

if (window.location.href.includes("#home")) {
    initializeIntro();
} else {
    destroyIntro();
}

if (scrollI || scrollII || scrollIII || pageI || pageII || pageIII || contact) {
    destroyIntro();
} else {
    initializeIntro();
}

window.addEventListener('locationchange', function () {
    var scrollI = window.location.href.includes("#I");
    var scrollII = window.location.href.includes("#II");
    var scrollIII = window.location.href.includes("#III");
    var contact = window.location.href.includes("#contact");

    var pageI = window.location.href.includes("/I");
    var pageII = window.location.href.includes("/II");
    var pageIII = window.location.href.includes("/III");

    if (window.location.href.includes("#home")) {
        initializeIntro();
    } else {
        destroyIntro();
    }

    if (scrollI || scrollII || scrollIII || pageI || pageII || pageIII || contact) {
        destroyIntro();
    } else {
        initializeIntro();
    }
});

$(window).on("load", function () {
    anime.timeline().add({
        targets: ".loader",
        translateY: [0, "-100%"],
        translateZ: 0,
        easing: "easeInOutCubic",
        duration: 800,
        complete: function () {
            $(".loader").addClass(".js-hidden")
        }
    }).add({
        targets: ".active .js-letter",
        translateX: ["-105%", 0],
        translateZ: 0,
        easing: "easeInOutCubic",
        duration: 800,
        delay: function (el, i) {
            return 50 * i
        },
        offset: "-=1200"
    });
});

/// Setting up Barba JS
intializeBarba();

/// Setting up the custom scrolling and the scroll animations
setupScrollingAndScrollAnimations();

/// Setting up the menu
setupMenu();